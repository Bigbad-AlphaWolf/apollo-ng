<p-table #dt [value]="mails" responsiveLayout="scroll" [rows]="10" [globalFilterFields]="['from','title','message']" [paginator]="true" [rowsPerPageOptions]="[10,20,30]" [(selection)]="selectedMails" selectionMode="multiple" [rowHover]="true" dataKey="id">
    <ng-template pTemplate="caption">
        <div class="flex md:justify-content-between md:align-items-center">
            <div class="flex gap-2 align-items-center">
                <div class="flex w-3rem h-3rem p-2 border-1 surface-border flex align-items-center justify-content-center border-round">
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </div>
                <button pButton pRipple type="button" icon="pi pi-refresh" class="p-button-outlined p-button-secondary surface-border text-900 w-3rem h-3rem"></button>
                <button pButton pRipple type="button" icon="pi pi-ellipsis-v" class="p-button-outlined p-button-secondary surface-border text-900 w-3rem h-3rem" (click)="menu.toggle($event)"></button>
                <p-menu #menu [model]="menuItems" [appendTo]="dt" [popup]="true"></p-menu>
            </div>
            
            <span class="block mt-2 p-input-icon-left w-full h-3rem mb-2 pr-3 md:w-auto md:h-auto md:mb-0 md:mt-0 md:pr-0">
                <i class="pi pi-search"></i>
                <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Search Mail" class="w-full h-3rem pr-3 md:h-auto md:w-auto  md:pr-0"/>
            </span>
        </div>
    </ng-template>
    <ng-template pTemplate="body" let-mail>
        <tr (mouseenter)="toggleOptions($event, options, date)" (mouseleave)="toggleOptions($event, options, date)" (click)="onRowSelect(mail.id)" class="cursor-pointer">
            <td style="width: 5%; min-width: 2rem;">
                <p-tableCheckbox [value]="mail" (click)="$event.stopPropagation()"></p-tableCheckbox>
            </td>
            <td *ngIf="!mail.trash && !mail.spam" style="width: 5%; min-width: 2rem;">
                <span (click)="$event.stopPropagation(); onStar(mail.id)" class="cursor-pointer">
                    <i class="pi pi-fw text-xl" [ngClass]="{'pi-star-fill': mail.starred, 'pi-star': !mail.starred}"></i>
                </span>
            </td>
            <td *ngIf="!mail.trash && !mail.spam" style="width: 5%; min-width: 2rem;">
                <span (click)="$event.stopPropagation(); onBookmark(mail.id)" class="cursor-pointer">
                    <i class="pi pi-fw text-xl" [ngClass]="{'pi-bookmark-fill': mail.important, 'pi-bookmark': !mail.important}"></i>
                </span>
            </td>
            <td style="width: 5%; min-width: 2rem;">
                <p-avatar [image]="mail.image ? 'assets/demo/images/avatar/' + mail.image : 'assets/layout/images/avatar.png'"></p-avatar>
            </td>
            <td style="width: 10%; min-width: 10rem;" class="text-900 font-semibold">
                {{mail.from || mail.to}}
            </td>
            <td style="width: 58%; min-width: 10rem">
                <span class="text-700 font-semibold white-space-nowrap overflow-hidden text-overflow-ellipsis block w-11">
                    {{mail.title}}
                </span>
            </td>
            <td style="width: 10%; min-width: 8rem;">
                <div class="flex justify-content-end w-full px-0">
                    <span #date class="text-700 font-semibold white-space-nowrap">
                        {{mail.date}}
                    </span>
                    <div class="column-gap-2" style="display: none" #options>
                        <button pButton pRipple icon="pi pi-inbox" class="h-2rem w-2rem" (click)="onArchive($event, mail.id)" pTooltip="Archive" tooltipPosition="top"></button>
                        <button pButton pRipple icon="pi pi-reply" class="h-2rem w-2rem" (click)="onReply($event, mail)" pTooltip="Reply" tooltipPosition="top"></button>
                        <button pButton pRipple icon="pi pi-trash" class="h-2rem w-2rem" (click)="onTrash($event, mail)" pTooltip="Trash" tooltipPosition="top"></button>
                    </div>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-dialog [(visible)]="dialogVisible" (onHide)="dialogVisible = false" [closable]="true" header="New Message" [modal]="true" styleClass="w-full md:w-10 lg:w-6">
    <mail-reply [content]="mail" (hide)="dialogVisible = false"></mail-reply>
</p-dialog>